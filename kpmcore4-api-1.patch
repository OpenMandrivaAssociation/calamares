diff -Naur calamares-3.2.7/src/modules/fsresizer/CMakeLists.txt calamares-3.2.7-p/src/modules/fsresizer/CMakeLists.txt
--- calamares-3.2.7/src/modules/fsresizer/CMakeLists.txt	2019-04-27 20:12:03.000000000 +0200
+++ calamares-3.2.7-p/src/modules/fsresizer/CMakeLists.txt	2019-06-13 18:02:46.258839673 +0200
@@ -1,4 +1,4 @@
-find_package( KPMcore 3.3 )
+find_package( KPMcore )
 find_package( Qt5 REQUIRED DBus )  # Needed for KPMCore
 find_package( KF5 REQUIRED I18n WidgetsAddons )  # Needed for KPMCore
 
@@ -8,10 +8,10 @@
     include_directories( ${KPMCORE_INCLUDE_DIR} )
     include_directories( ${PROJECT_BINARY_DIR}/src/libcalamares )
 
-    if ( KPMcore_VERSION VERSION_GREATER "3.3.0")
+    if ( KPMcore_VERSION VERSION_GREATER "3.3.0" AND KPMcore_VERSION LESS "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE331API) # kpmcore > 3.3.0 with deprecations
     endif()
-    if ( KPMcore_VERSION VERSION_GREATER "3.90")
+    if ( KPMcore_VERSION VERSION_GREATER "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE4API) # kpmcore 4 with new API
     endif()
 
diff -Naur calamares-3.2.7/src/modules/partition/CMakeLists.txt calamares-3.2.7-p/src/modules/partition/CMakeLists.txt
--- calamares-3.2.7/src/modules/partition/CMakeLists.txt	2019-04-27 20:12:03.000000000 +0200
+++ calamares-3.2.7-p/src/modules/partition/CMakeLists.txt	2019-06-13 18:02:04.551550194 +0200
@@ -20,17 +20,17 @@
 find_package( Qt5 REQUIRED DBus )
 find_package( KF5 REQUIRED Config CoreAddons I18n WidgetsAddons )
 
-find_package( KPMcore 3.3 )
+find_package( KPMcore )
 set_package_properties(
     KPMcore PROPERTIES
     PURPOSE "For partitioning module"
 )
 
 if ( KPMcore_FOUND )
-    if ( KPMcore_VERSION VERSION_GREATER "3.3.0")
+    if ( KPMcore_VERSION VERSION_GREATER "3.3.0" AND KPMcore_VERSION LESS "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE331API) # kpmcore > 3.3.0 with deprecations
     endif()
-    if ( KPMcore_VERSION VERSION_GREATER "3.90")
+    if ( KPMcore_VERSION VERSION_GREATER "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE4API) # kpmcore 4 with new API
     endif()
 
diff -Naur calamares-3.2.7/src/modules/partition/core/KPMHelpers.h calamares-3.2.7-p/src/modules/partition/core/KPMHelpers.h
--- calamares-3.2.7/src/modules/partition/core/KPMHelpers.h	2019-04-27 20:12:03.000000000 +0200
+++ calamares-3.2.7-p/src/modules/partition/core/KPMHelpers.h	2019-06-13 17:59:03.590290085 +0200
@@ -34,7 +34,7 @@
 class PartitionNode;
 class PartitionRole;
 
-#ifdef WITH_KPMCORE331API
+#ifdef WITH_KPMCORE4API
 #define KPM_PARTITION_FLAG(x) PartitionTable::Flag::x
 #define KPM_PARTITION_STATE(x) Partition::State::x
 #define KPM_PARTITION_FLAG_ESP PartitionTable::Flag::Boot
diff -Naur calamares-3.2.7/src/modules/partition/core/PartitionCoreModule.cpp calamares-3.2.7-p/src/modules/partition/core/PartitionCoreModule.cpp
--- calamares-3.2.7/src/modules/partition/core/PartitionCoreModule.cpp	2019-04-27 20:12:03.000000000 +0200
+++ calamares-3.2.7-p/src/modules/partition/core/PartitionCoreModule.cpp	2019-06-13 17:59:03.590290085 +0200
@@ -857,8 +857,9 @@
     {
         if ( part->mountPoint() == "/" )
         {
+            // use KPM_PARTITION_FLAG_ESP so it works with both APIs of kpmcore
             createPartition( dev, part,
-                             part->activeFlags() | ( isEfi ? KPM_PARTITION_FLAG(None) : KPM_PARTITION_FLAG(Boot) )
+                             part->activeFlags() | ( isEfi ? KPM_PARTITION_FLAG(None) : KPM_PARTITION_FLAG_ESP )
                            );
         }
         else
