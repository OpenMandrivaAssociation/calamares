diff -up calamares-3.2.12/src/modules/fsresizer/CMakeLists.txt.8~ calamares-3.2.12/src/modules/fsresizer/CMakeLists.txt
--- calamares-3.2.12/src/modules/fsresizer/CMakeLists.txt.8~	2019-08-22 15:33:02.881870140 +0200
+++ calamares-3.2.12/src/modules/fsresizer/CMakeLists.txt	2019-08-22 15:33:55.196028465 +0200
@@ -1,4 +1,4 @@
-find_package( KPMcore 3.3 )
+find_package( KPMcore )
 
 set( _partition_defs "" )
 
@@ -8,10 +8,10 @@ if ( KPMcore_FOUND )
 
     include_directories( ${KPMCORE_INCLUDE_DIR} ${CMAKE_SOURCE_DIR}/src/modules/partition )
 
-    if ( KPMcore_VERSION VERSION_GREATER "3.3.0")
+    if ( KPMcore_VERSION VERSION_GREATER "3.3.0"  AND KPMcore_VERSION LESS "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE331API) # kpmcore > 3.3.0 with deprecations
     endif()
-    if ( KPMcore_VERSION VERSION_GREATER "3.90")
+    if ( KPMcore_VERSION VERSION_GREATER "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE4API) # kpmcore 4 with new API
     endif()
 
diff -up calamares-3.2.12/src/modules/partition/CMakeLists.txt.8~ calamares-3.2.12/src/modules/partition/CMakeLists.txt
--- calamares-3.2.12/src/modules/partition/CMakeLists.txt.8~	2019-08-22 15:33:02.881870140 +0200
+++ calamares-3.2.12/src/modules/partition/CMakeLists.txt	2019-08-22 15:34:22.747111827 +0200
@@ -15,7 +15,7 @@ endif()
 
 find_package(ECM ${ECM_VERSION} REQUIRED NO_MODULE)
 
-find_package( KPMcore 3.3 )
+find_package( KPMcore )
 set_package_properties(
     KPMcore PROPERTIES
     PURPOSE "For partitioning module"
@@ -25,10 +25,10 @@ if ( KPMcore_FOUND )
     find_package( Qt5 REQUIRED DBus )
     find_package( KF5 REQUIRED Config CoreAddons I18n WidgetsAddons )
 
-    if ( KPMcore_VERSION VERSION_GREATER "3.3.0")
+    if ( KPMcore_VERSION VERSION_GREATER "3.3.0"  AND KPMcore_VERSION LESS "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE331API) # kpmcore > 3.3.0 with deprecations
     endif()
-    if ( KPMcore_VERSION VERSION_GREATER "3.90")
+    if ( KPMcore_VERSION VERSION_GREATER "3.80.0")
         list( APPEND _partition_defs WITH_KPMCORE4API) # kpmcore 4 with new API
     endif()
 
diff -up calamares-3.2.12/src/modules/partition/core/KPMHelpers.h.8~ calamares-3.2.12/src/modules/partition/core/KPMHelpers.h
--- calamares-3.2.12/src/modules/partition/core/KPMHelpers.h.8~	2019-08-07 12:58:22.000000000 +0200
+++ calamares-3.2.12/src/modules/partition/core/KPMHelpers.h	2019-08-22 15:33:02.881870140 +0200
@@ -34,7 +34,7 @@ class Partition;
 class PartitionNode;
 class PartitionRole;
 
-#ifdef WITH_KPMCORE331API
+#ifdef WITH_KPMCORE4API
 #define KPM_PARTITION_FLAG(x) PartitionTable::Flag::x
 #define KPM_PARTITION_STATE(x) Partition::State::x
 #define KPM_PARTITION_FLAG_ESP PartitionTable::Flag::Boot
diff -up calamares-3.2.12/src/modules/partition/core/PartitionCoreModule.cpp.8~ calamares-3.2.12/src/modules/partition/core/PartitionCoreModule.cpp
--- calamares-3.2.12/src/modules/partition/core/PartitionCoreModule.cpp.8~	2019-08-07 12:58:22.000000000 +0200
+++ calamares-3.2.12/src/modules/partition/core/PartitionCoreModule.cpp	2019-08-22 15:33:02.881870140 +0200
@@ -857,8 +857,9 @@ PartitionCoreModule::layoutApply( Device
     {
         if ( part->mountPoint() == "/" )
         {
+            // use KPM_PARTITION_FLAG_ESP so it works with both APIs of kpmcore
             createPartition( dev, part,
-                             part->activeFlags() | ( isEfi ? KPM_PARTITION_FLAG(None) : KPM_PARTITION_FLAG(Boot) )
+                             part->activeFlags() | ( isEfi ? KPM_PARTITION_FLAG(None) : KPM_PARTITION_FLAG_ESP )
                            );
         }
         else
