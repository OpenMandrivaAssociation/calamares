From 50187261c33b8f35eca1e055b7e9942bb39c9abe Mon Sep 17 00:00:00 2001
From: Teo Mrnjavac <teo@kde.org>
Date: Wed, 21 Dec 2016 13:58:17 +0100
Subject: [PATCH 10/16] Expose KPMcore version status to partition module.

---
 src/modules/partition/CMakeLists.txt       | 7 +++++++
 src/modules/partition/PartitionConfig.h.in | 6 ++++++
 2 files changed, 13 insertions(+)
 create mode 100644 src/modules/partition/PartitionConfig.h.in

diff --git a/src/modules/partition/CMakeLists.txt b/src/modules/partition/CMakeLists.txt
index b8e23bf..539bf08 100644
--- a/src/modules/partition/CMakeLists.txt
+++ b/src/modules/partition/CMakeLists.txt
@@ -11,6 +11,13 @@ find_package( KF5 REQUIRED CoreAddons )
 find_package( KF5 REQUIRED Config I18n IconThemes KIO Service )
 
 find_package( KPMcore 2.2 REQUIRED )
+if(KPMcore_VERSION VERSION_LESS 3.0.0)
+    set(WITH_KPMCORE3 OFF)
+else()
+    set(WITH_KPMCORE3 ON)
+endif()
+configure_file( ${CMAKE_CURRENT_SOURCE_DIR}/PartitionConfig.h.in
+                ${CMAKE_CURRENT_BINARY_DIR}/PartitionConfig.h )
 
 add_subdirectory( tests )
 
diff --git a/src/modules/partition/PartitionConfig.h.in b/src/modules/partition/PartitionConfig.h.in
new file mode 100644
index 0000000..024f02d
--- /dev/null
+++ b/src/modules/partition/PartitionConfig.h.in
@@ -0,0 +1,6 @@
+#ifndef CALAMARESPARTITIONCONFIG_H
+#define CALAMARESPARTITIONCONFIG_H
+
+#cmakedefine WITH_KPMCORE3
+
+#endif // CALAMARESPARTITIONCONFIG_H
-- 
2.8.3

